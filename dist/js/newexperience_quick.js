"use strict";function setTitle(){consumption.title=$("#title").val(),consumption.date=Math.floor(((new Date).getTime()-6e4*(new Date).getTimezoneOffset())/1e3),$("ul.tabs").tabs("select_tab","drug")}function setDrug(t,n,e){consumption.drug=t,consumption.drugName=atob(n),consumption.drugUnit=atob(e);var o=[];experiences.forEach(function(n){n.consumptions.forEach(function(n){n.drug.id===t&&(o[n.method.id]=n.method.name)})}),$("#methodList").empty();for(var i in o)o.hasOwnProperty(i)&&$("#methodList").append('<a href="#" class="collection-item" onclick="setMethod('+i+", '"+btoa(o[i])+"');\">"+o[i]+"</a>");$("ul.tabs").tabs("select_tab","method")}function setMethod(t,n){consumption.method=t,consumption.methodName=atob(n),$("#unit").html("("+consumption.drugUnit+")"),$("ul.tabs").tabs("select_tab","count")}function setCount(t){consumption.count=t;var n=[];experiences.forEach(function(t){t.consumptions.forEach(function(t){t.friends.forEach(function(t){-1===n.indexOf(t.name)&&n.push(t.name)})})}),n.forEach(function(t){$("#friendList").append('<input id="'+t+'" name="friendEntry" type="checkbox"><label for="'+t+'">'+t+"</label><br />")}),$("ul.tabs").tabs("select_tab","friends")}function setFriends(){consumption.friends=$('input[type="checkbox"][name="friendEntry"]:checked').map(function(){return this.id}).get();var t=[];experiences.forEach(function(n){n.consumptions.forEach(function(n){-1===t.indexOf(n.location)&&t.push(n.location)})}),t.forEach(function(t){$("#locationList").append('<a href="#" class="collection-item" onclick="setLocation(\''+btoa(t)+"');\">"+t+"</a>")}),$("ul.tabs").tabs("select_tab","location")}function setLocation(t){consumption.location=atob(t),$("#fTitle").html(consumption.title),$("#fDate").html(new Date(1e3*consumption.date).toISOString().slice(0,16).replace(/T/," ")),$("#fCon").html(consumption.count+" "+consumption.drugUnit+" "+consumption.drugName+" "+consumption.methodName),$("#fLoc").html(consumption.location);var n;n=0===consumption.friends.length?"[none]":consumption.friends.join(", "),$("#fFriends").html(n),$("ul.tabs").tabs("select_tab","finalize")}function create(){makeAuthRequest("/experience","POST",JSON.stringify({title:consumption.title,date:consumption.date}),"json",function(t,n,e){if(t)return void Materialize.toast(t.charAt(0).toUpperCase()+t.slice(1),6e3,"warning-toast");Materialize.toast("Experience created",6e3,"success-toast");var o={date:consumption.date,count:consumption.count,experience_id:n.id,drug_id:consumption.drug,method_id:consumption.method,location:consumption.location};makeAuthRequest("/consumption","POST",JSON.stringify(o),"json",function(t,n,e){return t?void Materialize.toast(t.charAt(0).toUpperCase()+t.slice(1),6e3,"warning-toast"):(Materialize.toast("Consumption created",6e3,"success-toast"),0===consumption.friends.length?void(window.location.href="/quick.html"):void consumption.friends.forEach(function(t,e){makeAuthRequest("/consumption/friend","POST",JSON.stringify({consumption_id:n.id,name:t}),"json",function(t,n,o){e===consumption.friends.length-1&&(Materialize.toast("Friends added",6e3,"success-toast"),window.location.href="/quick.html")})}))})})}var consumption={},experiences,unit,$input=$(".datepicker").pickadate(),picker=$input.pickadate("picker");picker.set("select",new Date);var actions=["Shenanigans","Chillaxment","Fun","Amusement","Things","Hoopla","BS","Funtime","Smorgasbord "],action=actions[Math.floor(Math.random()*actions.length)],hour=(new Date).getHours(),timing;hour>=0&&4>=hour?timing="Early Morning":hour>=5&&9>=hour?timing="Mid Morning":hour>=10&&14>=hour?timing="Mid Day":hour>=15&&19>=hour?timing="Evening":hour>=19&&23>=hour&&(timing="Night");var title=timing+" "+action+" (Autotitle)";$("#title").val(title),$("#title").focus(function(){$("#title").val()===title&&$("#title").val("")}),$("#title").focusout(function(){""===$("#title").val()&&$("#title").val(title)});var drugData={};makeAuthRequest("/experience/search","POST",JSON.stringify({startdate:Math.round(+new Date/1e3)-604800,enddate:Math.round(+new Date/1e3)}),"json",function(t,n,e){experiences=n,experiences.forEach(function(t){t.consumptions.forEach(function(t){drugData.hasOwnProperty(t.drug.name)||(drugData[t.drug.name]=t.drug)})});for(var o in drugData)drugData.hasOwnProperty(o)&&$("#drugList").append('<a href="#" class="collection-item" onclick="setDrug('+drugData[o].id+", '"+btoa(o)+"', '"+btoa(drugData[o].unit)+"');\">"+o+"</a>")});
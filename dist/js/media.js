"use strict";function loadMore(){atEnd||makeAuthRequest("/media/search","POST",JSON.stringify({limit:batchSize,offset:currentBatch*batchSize}),"json",function(e,a,t){404!==t&&a.length===batchSize?currentBatch+=1:atEnd=!0,a.forEach(function(e,a){a%4===0&&$("#media").append('<div id="row'+Math.floor(a/4)+'" class="row"></div>');var t=(getCookie("server")+"/media/file/"+e.id,"");"experience"===e.association_type&&(t='<br><a href="/experience.html?'+e.association+'">View Experience</a>'),$("#row"+Math.floor(a/4)).append('<div class="col s12 m3"><div class="card"><div class="card-image"><a id="imagelink'+e.id+'"><img id="image'+e.id+'"/><span class="card-title">'+e.title+'</span><a/></div><div class="card-content"><p>'+new Date(1e3*e.date).toISOString().slice(5,16).replace(/T/," ").replace("-","/")+t+"</p></div></div></div>"),makeAuthBlobRequest("/media/file/"+e.id,function(a){var t=window.URL||window.webkitURL;$("#image"+e.id).attr("src",t.createObjectURL(a)),$("#imagelink"+e.id).attr("href",t.createObjectURL(a))})}),$("#loading").hide(),$("#media").show()})}function prepareAdd(){var e=new Date,a=e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+" "+("0"+e.getHours()).slice(-2)+("0"+e.getMinutes()).slice(-2);$("#customTime").val(a),makeAuthRequest("/experience/search","POST",null,"json",function(e,a,t){return a.length<1?void $("#experience").append('<option value="" disabled selected>None</option>'):(a.sort(function(e,a){return parseFloat(a.date)-parseFloat(e.date)}),void a.forEach(function(e){$("#experience").append('<option value="'+e.id+'">'+new Date(1e3*e.date).toISOString().slice(0,10)+" -- "+e.title+"</option>")}))})}var currentBatch=0,batchSize=24,atEnd=!1;makeAuthRequest("/media/search","POST",null,"json",function(e,a,t){404===t&&($("#loading").hide(),$("#emptyMedia").show())}),$("#addMedia").submit(function(e){e.preventDefault();var a=$("#customTime").val().split(" ")[0],t=$("#customTime").val().split(" ")[1],i=Math.floor(new Date(a).getTime()/1e3);i+=3600*Math.floor(t/100),i+=60*(t-100*Math.floor(t/100));var o=new FormData;o.append("title",$("#title").val()),o.append("tags",$("#tags").val()),"custom"===$("input:radio[name=time]:checked").val()&&o.append("date",i),o.append("association_type","experience"),o.append("association",$("#experience").val()),$("#favorite").is(":checked")&&o.append("favorite",1),$("#explicit").is(":checked")&&o.append("explicit",1),o.append("image",$("#mediaFile").prop("files")[0]);var n=getCookie("auth"),d=getCookie("server"),c=new XMLHttpRequest;c.onload=function(e){4===c.readyState&&(201===c.status?($("#addMediaModal").closeModal(),Materialize.toast("Media added",6e3,"success-toast"),setTimeout(function(){window.location="/media.html"},1e3)):($("#addMediaModal").closeModal(),Materialize.toast(c.statusText,4e3,"warning-toast")))},c.onerror=function(e){$("#addMediaModal").closeModal(),Materialize.toast(c.statusText,4e3,"warning-toast")},c.open("POST",d+"/media"),c.setRequestHeader("Authorization","Basic "+n),c.send(o)}),$("input:radio[name=time]").on("change",function(){"custom"===$("input:radio[name=time]:checked").val()?$("#customTimeArea").show():$("#customTimeArea").hide()}),$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-50&&loadMore()}),loadMore(),prepareAdd();
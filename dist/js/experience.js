"use strict";function setUpAddConsumptions(){var e=$(".datepicker").pickadate(),t=e.pickadate("picker");t.set("select",new Date);var o=new Date;$("#addTime").val(("0"+o.getHours()).slice(-2)+("0"+o.getMinutes()).slice(-2)),$("#addtimeLabel").addClass("active"),makeAuthRequest("/drug/all","GET",null,"json",function(e,t,o){return t.length<1?void $("#addDrug").append('<option value="" disabled selected>None</option>'):void t.forEach(function(e){$("#addDrug").append('<option value="'+e.id+'">'+e.name+" ("+e.unit+")</option>")})}),makeAuthRequest("/method/all","GET",null,"json",function(e,t,o){return t.length<1?void $("#addMethod").append('<option value="" disabled selected>None</option>'):void t.forEach(function(e){$("#addMethod").append('<option value="'+e.id+'">'+e.name+"</option>")})})}var experienceID=location.search.slice(1),noteSaveNotificationTimeout;$("#addConsumption").submit(function(e){e.preventDefault();var t=Math.floor(Date.parse($("#addDate").val())/1e3),o=Math.floor($("#addTime").val()/100),n=$("#addTime").val()%100,i=3600*o+60*n,a=t+i,s={date:a,count:$("#addCount").val(),experience_id:experienceID,drug_id:$("#addDrug").val(),method_id:$("#addMethod").val(),location:$("#addLocation").val()};makeAuthRequest("/consumption","POST",JSON.stringify(s),"json",function(e,t,o){return e?void Materialize.toast(e.charAt(0).toUpperCase()+e.slice(1),6e3,"warning-toast"):(console.log("drawing in the consumption"),void Materialize.toast("Consumption created",6e3,"success-toast"))})}),$(document).ready(function(){makeAuthRequest("/experience/"+experienceID,"GET",null,"json",function(e,t,o){if(404===o)return $("#loading").hide(),void $("#noExperience").show();$("#title").text(t.title);var n=new Date(1e3*t.date);$("#date").text(n.toISOString().slice(0,16).replace(/T/," ")),t.consumptions.length<1?$("#noConsumptions").show():($("#noConsumptions").hide(),t.consumptions.forEach(function(e){console.log(e),$("#consumptionsCollection").append('<li class="collection-item">'+e.count+" "+e.drug.unit+" "+e.drug.name+", "+e.method.name+'<a href="#" class="secondary-content"><i class="material-icons">send</i></a></div></li>')})),setUpAddConsumptions(),$("#notesArea").text(t.notes),$("#notesArea").trigger("autoresize"),$("#loading").hide(),$("#main").show(),$("ul.tabs").tabs("select_tab","consumptions")})}),$("#notesArea").on("change keyup paste",function(){clearTimeout(noteSaveNotificationTimeout),noteSaveNotificationTimeout=setTimeout(function(){Materialize.toast("Notes saved.",1e3),makeAuthRequest("/experience","PUT",JSON.stringify({id:experienceID,notes:$("#notesArea").val()}),"json",function(e,t,o){console.log(e,t)})},1e3)});
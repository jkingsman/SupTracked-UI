"use strict";function startHistorical(){friends(),drugs(),basics(),experience_list(),hourly_daily_breakdown(),calendar(),media()}function dateToFormat(e){return e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)}function parseUrlParam(e){return location.search.split(e+"=")[1].split("&")[0]}var drug,allDrugs,allConsumptions=[],allExperiences,analyticsCount=0,analyticsFinished=0,friends,drugs,basics,experience_list,hourly_daily_breakdown,calendar,media,start,end;if(0===location.search.length){var today=new Date,weekAgo=new Date((new Date).setDate((new Date).getDate()-7));window.location="/historical.html?start="+dateToFormat(weekAgo)+"&end="+dateToFormat(today)}else start=new Date(parseUrlParam("start")).getTime()/1e3,end=new Date(parseUrlParam("end")).getTime()/1e3,$(".start").html(parseUrlParam("start")),$(".end").html(parseUrlParam("end")),makeAuthRequest("/experience/search","POST",JSON.stringify({startdate:start,enddate:end}),"json",function(e,t,a){return e?($("#noCon").show(),$("#cons").hide(),void $("#loading").hide()):(allExperiences=t,t.forEach(function(e){e.consumptions.forEach(function(t){t.expTitle=e.title,allConsumptions.push(t)})}),void startHistorical())});var updateInterval=setInterval(function(){$("#historicalComplete").text(Math.round(analyticsFinished/analyticsCount*100)),$("#historicalProgress").css("width",Math.round(analyticsFinished/analyticsCount*100)+"%"),analyticsFinished===analyticsCount&&(clearInterval(updateInterval),setTimeout(function(){$("#loading").hide(),$("#cons").show()},500))},100);
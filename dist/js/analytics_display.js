function experience_list(){"use strict";$("#experienceContainer").empty(),allExperiences.forEach(function(n){n.title.length<1&&(n.title="[none]");var e=0;n.consumptions.forEach(function(n){n.drug.id===drug.id&&(e+=n.count)});var i=[],t="Solo Experience";n.consumptions.forEach(function(n){n.friends.forEach(function(n){-1===i.indexOf(n.name)&&i.push(n.name)})}),i.length>0&&(t=i.join(", "));var a=[],o="[no location]";n.consumptions.forEach(function(n){-1===a.indexOf(n.location)&&a.push(n.location)}),a.length>0&&(o=a.join(", ")),$("#experienceContainer").append('<li class="collection-item">'+new Date(1e3*n.date).toISOString().slice(0,10)+'<span class="right hide-on-med-and-down" style="max-width: 50%;">'+t+" at <strong>"+o+'</strong></span><h5><a href="/experience.html?'+n.id+'">'+n.title+'</a></h5><div class="pad-left-40">'+e+" "+drug.unit+" "+drug.name+"</div></li>")}),analyticsFinished+=1}var analyticsCount,analyticsFinished,allDrugs,allConsumptions,drug,allExperiences;analyticsCount+=1;
function hourly(){"use strict";for(var t=[],e=0;23>=e;e+=1)t[e]=0;var a=6e4*(new Date).getTimezoneOffset();allConsumptions.forEach(function(e){var n=new Date(1e3*e.date+a),i=n.getHours();t[i]+=1}),$("#hourly").empty().highcharts({chart:{type:"column"},title:{text:"Consumptions by hour"},xAxis:{categories:["0000 - 0100","0100 - 0200","0200 - 0300","0300 - 0400","0400 - 0500","0500 - 0600","0600 - 0700","0700 - 0800","0800 - 0900","0900 - 1000","1000 - 1100","1100 - 1200","1200 - 1300","1300 - 1400","1400 - 1500","1500 - 1600","1600 - 1700","1700 - 1800","1800 - 1900","1900 - 2000","2000 - 2100","2100 - 2200","2200 - 2300","2300 - 0000"],crosshair:!0},yAxis:{min:0,title:{text:"Consumptions"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}: </span>',pointFormat:"<b>{point.y} consumptions</b>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:drug.name,data:t}]}),setTimeout(function(){$("#hourly").highcharts().reflow()},2e3),analyticsFinished+=1}function daily(){"use strict";for(var t=[],e=0;6>=e;e+=1)t[e]=0;var a=6e4*(new Date).getTimezoneOffset();allConsumptions.forEach(function(e){var n=new Date(1e3*e.date+a),i=n.getDay();t[i]+=1}),$("#daily").empty().highcharts({chart:{type:"column"},title:{text:"Consumptions by Day"},xAxis:{categories:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],crosshair:!0},yAxis:{min:0,title:{text:"Consumptions"}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}: </span>',pointFormat:"<b>{point.y} consumptions</b>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:drug.name,data:t}]}),setTimeout(function(){$("#daily").highcharts().reflow()},2e3),analyticsFinished+=1}function computeRegressionPts(t){"use strict";var e=0,a=0,n=0,i=0,o=t.length;t.forEach(function(t,o){e+=o,a+=t,n+=t*o,i+=o*o});var s=(a*i-e*n)/(o*i-e*e),r=(o*n-e*a)/(o*i-e*e);return[[0,s],[o-1,(o-1)*r+s]]}function weekly(){"use strict";var t=[],e=[],a=new Date;0!==a.getDay()&&a.setDate(a.getDate()-a.getDay());for(var n=0;25>=n;n+=1)t[n]=0,e.push("Week of "+(a.getMonth()+1)+"/"+a.getDate()),a.setDate(a.getDate()-7);var i=new Date;0!==i.getDay()&&i.setDate(i.getDate()-i.getDay());var o=6e4*i.getTimezoneOffset();allConsumptions.forEach(function(e){var a=new Date(1e3*e.date+o),n=(i-a)/864e5,s=Math.floor(n/7)+1;25>=s&&(t[s]+=e.count)}),t.reverse(),e.reverse();var s=computeRegressionPts(t);$("#weekly").empty().highcharts({chart:{type:"column"},title:{text:drug.unit+" per Week"},xAxis:{categories:e,crosshair:!0},yAxis:{min:0,title:{text:drug.unit+" of "+drug.name}},tooltip:{headerFormat:'<span style="font-size:10px">{point.key}: </span>',pointFormat:"<b>{point.y} "+drug.unit+"</b>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:drug.name,data:t},{type:"line",name:"Trend",data:s,marker:{enabled:!1},states:{hover:{lineWidth:0}},enableMouseTracking:!1}]}),setTimeout(function(){$("#weekly").highcharts().reflow()},2e3),analyticsFinished+=1}function hours_days(){"use strict";hourly(),daily(),weekly()}var analyticsCount,analyticsFinished,allDrugs,allConsumptions,drug;analyticsCount+=3;
function purchasing(){"use strict";$("#purchaseUnit").html(drug.unit),drug.notes.split("$$$purchasedata$$$")[1]&&drawPurchasings(),analyticsFinished+=1}function drawPurchasings(){"use strict";$("#noteEntries").empty();var t=JSON.parse(drug.notes.split("$$$purchasedata$$$")[1]);t.forEach(function(t,a){$("#noteEntries").append('<tr><td><a href="#" title="Delete" onClick="delPurchasing('+a+')" class="secondary-content consumption-icon"><i class="material-icons">delete</i></a></td><td>'+t.date+"</td><td>"+t.count+"</td><td>"+t.notes+"</td></tr>")}),$("#purchasedRecord").html(t.reduce(function(t,a){return t+Number(a.count)},0)+" "+drug.unit)}function delPurchasing(t){"use strict";var a=drug.notes.split("$$$purchasedata$$")[0],s=JSON.parse(drug.notes.split("$$$purchasedata$$$")[1]),e=[];s.forEach(function(a,s){s!==t&&e.push(a)}),a+="$$$purchasedata$$$"+JSON.stringify(e),drug.notes=a,commitPurchases()}function addPurchasing(){"use strict";var t={date:$("#addPurchaseDate").val(),count:$("#addPurchaseCount").val(),notes:$("#addPurchaseNotes").val()},a=drug.notes.split("$$$purchasedata$$")[0];$("#addPurchaseDate, #addPurchaseCount, #addPurchaseNotes").val("");var s=[];drug.notes.split("$$$purchasedata$$$")[1]?(s=JSON.parse(drug.notes.split("$$$purchasedata$$$")[1]),s.push(t)):s.push(t),s.sort(function(t,a){return t.date>a.date?-1:t.date<a.date?1:0}),a+="$$$purchasedata$$$"+JSON.stringify(s),drug.notes=a,commitPurchases()}function commitPurchases(){"use strict";makeAuthRequest("/drug","PUT",JSON.stringify({id:drug.id,notes:drug.notes}),"json",function(t,a,s){return 200!==s?void Materialize.toast("Drug notes save error: "+t,6e3,"warning-toast"):(drawPurchasings(),void Materialize.toast("Drug notes saved",1e3))})}var analyticsCount,analyticsFinished,allDrugs,allConsumptions,drug;analyticsCount+=1,$("#addPurchaseNotes").keyup(function(t){"use strict";13===t.keyCode&&addPurchasing()});
function top_listings(){"use strict";var n={};allConsumptions.forEach(function(o){n.hasOwnProperty(o.location)?n[o.location]=n[o.location]+1:n[o.location]=1});var o=Object.keys(n);o.sort(function(o,t){return n[o]>n[t]?-1:n[o]<n[t]?1:0}),o=o.slice(0,10);var t="<ol>"+o.map(function(o){return"<li>"+o+" ("+n[o]+" consumptions/"+Math.round(n[o]/allConsumptions.length*100,-1)+"%)</li>"}).join("")+"</ol>";$("#topLocations").empty().append(t),analyticsFinished+=1;var i={};allConsumptions.forEach(function(n){return 0===n.friends.length?void(i.hasOwnProperty("Solo")?i.Solo=i.Solo+1:i.Solo=1):void n.friends.forEach(function(n){i.hasOwnProperty(n.name)?i[n.name]=i[n.name]+1:i[n.name]=1})});var a=Object.keys(i);a.sort(function(n,o){return i[n]>i[o]?-1:i[n]<i[o]?1:0}),a=a.slice(0,10);var s="<ol>"+a.map(function(n){return"<li>"+n+" ("+i[n]+" consumptions/"+Math.round(i[n]/allConsumptions.length*100,-1)+"%)</li>"}).join("")+"</ol>";0===a.length?$("#topFriends").empty().append("<i>None</i>"):$("#topFriends").empty().append(s),analyticsFinished+=1}var analyticsCount,analyticsFinished,allDrugs,allConsumptions,drug;analyticsCount+=2;
function vitals(){"use strict";function t(t){return t.date<=S[0].date+3600}allDrugs.sort(function(t,e){return t.use_count<e.use_count?1:t.use_count>e.use_count?-1:0});var e=allDrugs.map(function(t){return t.name}),a=e.indexOf(drug.name),n="";a>0&&(n='preceded by <a href="/analytics.html?'+allDrugs[a-1].id+'">'+e[a-1]+"</a>");var l="";a!==e.length-1&&(l='followed by <a href="/analytics.html?'+allDrugs[a+1].id+'">'+e[a+1]+"</a>");var s=0;allConsumptions.forEach(function(t){t.drug.id===drug.id&&(s+=t.count)});var r;r=n&&l?"("+n+" and "+l+")":n?"("+n+")":l?"("+l+")":"",$("#ranking").html("#"+(a+1)+" by usage with "+allDrugs[a].use_count+" uses/"+s+" "+drug.unit+" <i>"+r+"</i>"),$("#useFirst").html(new Date(1e3*allConsumptions[0].date).toISOString().slice(0,16).replace(/T/," ").replace(":","")+' -- <a href="/experience.html?'+allConsumptions[0].exp_id+'">'+allConsumptions[0].title+"</a>"),$("#useLast").html(new Date(1e3*allConsumptions[allConsumptions.length-1].date).toISOString().slice(0,16).replace(/T/," ").replace(":","")+' -- <a href="/experience.html?'+allConsumptions[allConsumptions.length-1].exp_id+'">'+allConsumptions[allConsumptions.length-1].title+"</a>");var i=JSON.parse(JSON.stringify(allConsumptions));i.sort(function(t,e){return e.count-t.count});var o=i.slice(0,3).map(function(t){return"<li>"+new Date(1e3*t.date).toISOString().slice(0,16).replace(/T/," ").replace(":","")+" -- "+t.count+" "+drug.unit+' -- <a href="/experience.html?'+t.exp_id+'">'+t.title+"</a></li>"});$("#largeDose").html('<ul class="pad-left-40">'+o.join("")+"</ul>");var u=allConsumptions.map(function(t){return Math.floor(new Date(1e3*t.date)/864e5)});u=u.filter(function(t,e){return u.indexOf(t)===e});var c=[],d={};u.forEach(function(t,e){return 0===e?(d.startDate=t,void(d.days=1)):e===u.length-1?void c.push({startDate:d.startDate,days:d.days}):void(t-u[e-1]===1?d.days+=1:(c.push({startDate:d.startDate,days:d.days}),d.startDate=t,d.days=1))}),c.sort(function(t,e){return t.days<e.days?1:t.days>e.days?-1:0}),$("#streak").html(c[0].days+" days <i>(starting on "+new Date(86400*c[0].startDate*1e3).toISOString().slice(0,10)+")</i>");var p,m,h=!1,f=0;allConsumptions.forEach(function(t,e){var a;return e===allConsumptions.length-1?(a=Math.floor((new Date).getTime()/1e3)-t.date,void(a>f&&(p=e,m=0,h=!0,f=a))):(a=allConsumptions[e+1].date-t.date,void(a>f&&(p=e,m=e+1,f=a)))});var g,C=new Date(1e3*allConsumptions[p].date).toISOString().slice(0,16).replace(/T/," ").replace(":","")+' (<a href="/experience.html?'+allConsumptions[p].exp_id+'">'+allConsumptions[p].title+"</a>)";g=h?(new Date).toISOString().slice(0,16).replace(/T/," ").replace(":","")+" (present)":new Date(1e3*allConsumptions[m].date).toISOString().slice(0,16).replace(/T/," ").replace(":","")+' (<a href="/experience.html?'+allConsumptions[m].exp_id+'">'+allConsumptions[m].title+"</a>)";var D=Math.floor(f/86400);$("#tBreak").html(C+" to "+g+" ("+D+" days)"),allConsumptions.sort(function(t,e){return e.date-t.date});for(var y={start:allConsumptions[0],count:allConsumptions[0].count},S=[allConsumptions[0]],v=1;v<allConsumptions.length;v+=1){S.unshift(allConsumptions[v]),S=S.filter(t);var w=S.reduce(function(t,e){return t+e.count},0);w>y.count&&(y.count=w,y.start=S[0])}$("#hourRecord").html(y.count+" "+drug.unit+" between "+new Date(1e3*y.start.date).toISOString().slice(11,16)+" and "+new Date(1e3*(y.start.date+3600)).toISOString().slice(11,16)+" "+new Date(1e3*y.start.date).toISOString().slice(0,10)+' during <a href="/experience.html?'+y.start.exp_id+'">'+y.start.title+"</a>"),analyticsFinished+=1}var analyticsCount,analyticsFinished,allDrugs,allConsumptions,drug;analyticsCount+=1;
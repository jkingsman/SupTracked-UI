"use strict";function loadMore(){atEnd||makeAuthRequest("/experience/search","POST",JSON.stringify({limit:batchSize,offset:currentBatch*batchSize}),"json",function(e,t,n){404!==n?currentBatch+=1:atEnd=!0,t.sort(function(e,t){return parseFloat(t.date)-parseFloat(e.date)}),t.forEach(function(e){e.title.length<1&&(e.title="[none]");var t={};e.consumptions.forEach(function(e){t.hasOwnProperty(e.drug.name)?t[e.drug.name].count+=e.count:(t[e.drug.name]={},t[e.drug.name].count=e.count,t[e.drug.name].unit=e.drug.unit)});var n=[];if(Object.keys(t).length>0)for(var a in t)n.push(t[a].count+" "+t[a].unit+" "+a);else n.push("no consumptions");$("#experiences-collection").append('<li class="collection-item">'+new Date(1e3*e.date).toISOString().slice(0,10)+'<h5><a href="/experience.html?'+e.id+'">'+e.title+'</a></h5><div class="pad-left-40">'+n.join("<br />")+"</div></li>")}),$("#loading").hide(),$("#experiences").show()})}function prepareFilter(){var e=new Date,t=e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+" "+("0"+e.getHours()).slice(-2)+("0"+e.getMinutes()).slice(-2);$("#filterEndDate").val(t),$("#filterStartDate").val("1975-01-01 0000")}var currentBatch=0,batchSize=10,atEnd=!1;makeAuthRequest("/experience/search","POST",JSON.stringify({limit:1}),"json",function(e,t,n){404===n&&($("#loading").hide(),$("#emptyExperiences").show())});var autoLoader=function(){$(window).scrollTop()+$(window).height()>$(document).height()-50&&loadMore()};$("#filterForm").submit(function(e){e.preventDefault();var t={};$("#filterTitle").val().length>0&&(t.title=$("#filterTitle").val()),$("#filterNotes").val().length>0&&(t.notes=$("#filterNotes").val());var n=$("#filterStartDate").val().split(" ")[0],a=$("#filterStartDate").val().split(" ")[1],i=Math.floor(new Date(n).getTime()/1e3);i+=3600*Math.floor(a/100),i+=60*(a-100*Math.floor(a/100));var r=$("#filterEndDate").val().split(" ")[0],o=$("#filterEndDate").val().split(" ")[1],l=Math.floor(new Date(r).getTime()/1e3);l+=3600*Math.floor(o/100),l+=60*(o-100*Math.floor(o/100)),t.startdate=i,t.enddate=l,makeAuthRequest("/experience/search","POST",JSON.stringify(t),"json",function(e,t,n){$(".collection-item").remove(),$(window).off("scroll",autoLoader),t.sort(function(e,t){return parseFloat(t.date)-parseFloat(e.date)}),t.forEach(function(e){e.title.length<1&&(e.title="[none]");var t={};e.consumptions.forEach(function(e){t.hasOwnProperty(e.drug.name)?t[e.drug.name].count+=e.count:(t[e.drug.name]={},t[e.drug.name].count=e.count,t[e.drug.name].unit=e.drug.unit)});var n=[];if(Object.keys(t).length>0)for(var a in t)n.push(t[a].count+" "+t[a].unit+" "+a);else n.push("no consumptions");$("#experiences-collection").append('<li class="collection-item">'+new Date(1e3*e.date).toISOString().slice(0,10)+'<h5><a href="/experience.html?'+e.id+'">'+e.title+'</a></h5><div class="pad-left-40">'+n.join("<br />")+"</div></li>")})})}),loadMore(),prepareFilter(),$(window).scroll(autoLoader);
"use strict";function loadMore(){atEnd||makeAuthRequest("/experience/search","POST",JSON.stringify({limit:batchSize,offset:currentBatch*batchSize}),"json",function(e,t,n){404!==n?currentBatch+=1:atEnd=!0,t.sort(function(e,t){return parseFloat(t.date)-parseFloat(e.date)}),t.forEach(function(e){e.title.length<1&&(e.title="[none]");var t={};e.consumptions.forEach(function(e){t.hasOwnProperty(e.drug.name)?t[e.drug.name].count+=e.count:(t[e.drug.name]={},t[e.drug.name].count=e.count,t[e.drug.name].unit=e.drug.unit)});var n=[];if(Object.keys(t).length>0)for(var i in t)n.push(t[i].count+" "+t[i].unit+" "+i);else n.push("no consumptions");$("#experiences-collection").append('<li class="collection-item">'+new Date(1e3*e.date).toISOString().slice(0,10)+'<h5><a href="/experience.html?'+e.id+'">'+e.title+'</a></h5><div class="pad-left-40">'+n.join("<br />")+"</div></li>")}),$("#loading").hide(),$("#experiences").show()})}var currentBatch=0,batchSize=10,atEnd=!1;makeAuthRequest("/experience/search","POST",JSON.stringify({limit:1}),"json",function(e,t,n){404===n&&($("#loading").hide(),$("#emptyExperiences").show())}),loadMore(),$(window).scroll(function(){$(window).scrollTop()+$(window).height()>$(document).height()-50&&loadMore()});